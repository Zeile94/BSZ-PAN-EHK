<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CWE Mitarbeiterchat – Teams</title>
  <style>
    :root {
      --teams-purple: #464EB8;
      --teams-bg: #F3F2F1;
      --chat-bg: #FFFFFF;
      --me-bg: #D2DCF7;
      --bot-bg: #FFFFFF;
      --border-color: #E1DFDD;
      --text-color: #201F1E;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", Helvetica, Arial, sans-serif;
      background: var(--teams-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .chat-container {
      width: 850px;
      height: 600px;
      display: flex;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      background: var(--chat-bg);
    }

    /* Seitenleiste mit Chat-Kontakten */
    .sidebar {
      width: 260px;
      background: #f7f7f7;
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      background: var(--teams-purple);
      color: white;
      padding: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between; /* Platz zwischen beiden Logos */
    }

    .sidebar-header img {
      height: 22px; /* gleiche Höhe für beide Logos */
      object-fit: contain;
    }

    /* Haupt-Chatfenster */
    .contact {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: background 0.2s;
    }

    .contact:hover {
      background: #ececec;
    }

    .contact.active {
      background: #e0e0f8;
    }

    .contact img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .contact .info {
      display: flex;
      flex-direction: column;
    }

    .contact .name {
      font-weight: 600;
      font-size: 14px;
    }

    .contact .role {
      font-size: 12px;
      color: #666;
    }

    .chat {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--teams-bg);
    }

    .chat-header {
      background: var(--chat-bg);
      padding: 12px 14px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }

    .chat-header img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
    }

    .chat-header .info {
      display: flex;
      flex-direction: column;
    }

    .chat-header .name {
      font-weight: 600;
      font-size: 14px;
    }

    .chat-header .role {
      font-size: 12px;
      color: #605E5C;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 14px 18px;
      background: var(--teams-bg);
      display: flex;
      flex-direction: column;
    }

    .msg {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
      max-width: 75%;
    }

    .msg.user {
      align-self: flex-end;
      text-align: right;
    }

    .msg.bot {
      align-self: flex-start;
      text-align: left;
    }

    .bubble {
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .msg.user .bubble {
      background: var(--me-bg);
      color: var(--text-color);
    }

    .msg.bot .bubble {
      background: var(--bot-bg);
      border: 1px solid var(--border-color);
    }

    .composer {
      background: var(--chat-bg);
      border-top: 1px solid var(--border-color);
      padding: 10px 14px;
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    .composer textarea {
      flex: 1;
      min-height: 40px;
      max-height: 200px;
      resize: none;
      overflow-y: auto;
      padding: 8px 10px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-family: inherit;
      font-size: 13px;
      outline: none;
    }

    .composer button {
      background: var(--teams-purple);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.2); border-radius: 3px; }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="https://cdn.worldvectorlogo.com/logos/microsoft-teams-1.svg" alt="Teams Logo">
        <img src="public/00_Logo_CWE.png" alt="CWE_Logo" class="cwe-logo">
      </div>

      <div class="contact active" data-person="tina">
        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Tina Avatar">
        <div class="info">
          <div class="name">Tina</div>
          <div class="role">Abteilung Finanzen</div>
        </div>
      </div>

      <div class="contact" data-person="christian">
        <img src="https://randomuser.me/api/portraits/men/46.jpg" alt="Christian Avatar">
        <div class="info">
          <div class="name">Christian</div>
          <div class="role">Abteilung Marketing</div>
        </div>
      </div>
    </div>

    <div class="chat">
      <div class="chat-header">
        <img id="avatar" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Avatar">
        <div class="info">
          <div class="name" id="chatName">Tina</div>
          <div class="role" id="chatRole">Abteilung Finanzen</div>
        </div>
      </div>

      <div id="messages" class="messages"></div>

      <div class="composer">
        <textarea id="input" placeholder="Nachricht eingeben..."></textarea>
        <button id="send">Senden</button>
      </div>
    </div>
  </div>

  <script>
    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");
    const contacts = document.querySelectorAll(".contact");
    const chatName = document.getElementById("chatName");
    const chatRole = document.getElementById("chatRole");
    const avatar = document.getElementById("avatar");

    let currentPerson = "tina";

    const chatHistory = {
      tina: [],
      christian: []
    };

    contacts.forEach(c => {
      c.addEventListener("click", () => {
        contacts.forEach(el => el.classList.remove("active"));
        c.classList.add("active");
        currentPerson = c.dataset.person;

        chatName.textContent = c.querySelector(".name").textContent;
        chatRole.textContent = c.querySelector(".role").textContent;
        avatar.src = c.querySelector("img").src;

        messagesDiv.innerHTML = "";
        chatHistory[currentPerson].forEach(msg => appendMessage(msg.text, msg.who));
      });
    });

    input.addEventListener("input", () => {
      input.style.height = "auto";
      input.style.height = Math.min(input.scrollHeight, 200) + "px";
    });

    function appendMessage(text, who = "bot") {
      const msg = document.createElement("div");
      msg.className = "msg " + who;
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;
      msg.appendChild(bubble);
      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;

      appendMessage(text, "user");
      chatHistory[currentPerson].push({ text, who: "user" });
      input.value = "";
      input.style.height = "40px";
      sendBtn.disabled = true;

      let systemMessage = "";

      if (currentPerson === "tina") {
        systemMessage = `
Du bist Tina, eine frisch ausgelernte Kollegin in der Finanzabteilung der CenterWarenhaus GmbH Eggenfelden (CWE).
Antworte freundlich, höflich und kurz auf Fragen zur Buchführung, Rechnungen, Zahlungen und kaufmännischer Steuerung.
Vermeide lange Begrüßungen oder Verabschiedungen.
`;
      } else {
        systemMessage = `
Du bist Christian, Mitarbeiter im Marketing der CenterWarenhaus GmbH Eggenfelden (CWE).
Antworte freundlich, klar und kurz auf Fragen rund um Marketing, Werbung und Aktionen.
Vermeide Begrüßungen oder Verabschiedungen.
`;
      }

      try {
        const resp = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: [
              { role: "system", content: systemMessage },
              { role: "user", content: text }
            ]
          })
        });

        const data = await resp.json();
        const answer = data.message?.content || "Keine Antwort erhalten.";
        appendMessage(answer, "bot");
        chatHistory[currentPerson].push({ text: answer, who: "bot" });
      } catch (e) {
        appendMessage("Fehler beim Abruf: " + e.message, "bot");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
