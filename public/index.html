<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CWE – Mitarbeiterchat</title>

<style>
  :root {
    --bg: #121212;
    --surface: #1E1E1E;
    --surface-light: #2A2A2A;
    --text: #EAEAEA;
    --text-dim: #A8A8A8;
    --accent: #6264A7;
    --bubble-user: #2F49B5;
    --bubble-bot: #2A2A2A;
    --border: #333;
    --red-alert: #CC3333;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    display: flex;
    justify-content: center;
    padding: 20px 0;
    height: 100vh;
    overflow: hidden;
  }

  .phone {
    width: 390px;
    height: 760px;
    background: var(--surface);
    border-radius: 35px;
    border: 2px solid #000;
    box-shadow: 0 0 40px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }

  .header {
    background: white;
    height: 75px;
    padding: 0 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 17px;
    font-weight: 600;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 20;
    color: #000000;
    user-select: none;
    flex-shrink: 0;
    position: relative;
  }

  #notificationPreview {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--surface-light);
    color: white;
    height: 60px;
    line-height: 60px;
    font-weight: 600;
    font-size: 14px;
    display: none;
    cursor: pointer;
    padding-left: 60px;
    box-sizing: border-box;
    border-top: 1px solid var(--border);
    z-index: 25;
  }
  #notificationPreview img {
    position: absolute;
    top: 5px;
    left: 5px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
  }

  .header .ms-logo {
    position: absolute;
    left: 18px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .header .ms-logo img {
    max-width: 100%;
    max-height: 100%;
    display: block;
  }

  .header .logo {
    position: absolute;
    right: 18px;
    height: 40px;
    width: auto;
  }
  .header .logo img {
    height: 40px;
    width: auto;
    display: block;
  }

  #chatList {
    flex: 1;
    overflow-y: auto;
    background: var(--surface);
    display: block;
    position: relative;
  }

  .chat-item {
    display: flex;
    align-items: center;
    padding: 12px;
    gap: 12px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    position: relative;
  }

  .chat-item:hover {
    background: #2b2b2b;
  }

  .chat-item img {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    object-fit: cover;
    background: var(--surface-light);
  }

  .chat-item .info .name {
    font-size: 15px;
    font-weight: 600;
  }
  .chat-item .info .role {
    font-size: 13px;
    color: var(--text-dim);
  }

  .chat-item[data-person="claudia"]::after {
    content: attr(data-notifications);
    display: var(--notification-display, none);
    position: absolute;
    top: 12px;
    right: 18px;
    background: var(--red-alert);
    color: white;
    width: 20px;
    height: 20px;
    font-size: 12px;
    font-weight: 700;
    text-align: center;
    border-radius: 50%;
    line-height: 20px;
    pointer-events: none;
  }

  #chatWindow {
    display: none;
    flex-direction: column;
    height: 100%;
    position: relative;
    background: var(--surface);
    display: flex;
    flex: 1 1 auto;
    overflow: hidden;
  }

  .chat-header {
    background: var(--surface-light);
    display: flex;
    align-items: center;
    padding: 10px 14px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 10;
    flex-shrink: 0;
  }

  .back-btn {
    font-size: 22px;
    cursor: pointer;
    color: var(--accent);
    user-select: none;
    margin-right: 15px;
    flex-shrink: 0;
  }

  .chat-header img {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    object-fit: cover;
    background: var(--surface-light);
    margin-right: 15px;
    flex-shrink: 0;
  }

  .chat-header .name {
    font-size: 15px;
    font-weight: 600;
    white-space: nowrap;
  }

  .messages {
    flex: 1 1 auto;
    overflow-y: auto;
    padding: 10px 14px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) transparent;
  }

  .messages::-webkit-scrollbar {
    width: 6px;
  }
  .messages::-webkit-scrollbar-thumb {
    background-color: var(--accent);
    border-radius: 3px;
  }

  .msg {
    max-width: 75%;
    padding: 10px 14px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.4;
    white-space: pre-wrap;
    word-break: break-word;
  }

  .msg.user {
    background: var(--bubble-user);
    align-self: flex-end;
  }

  .msg.bot {
    background: var(--bubble-bot);
    border: 1px solid var(--border);
    align-self: flex-start;
  }

  .composer {
    background: var(--surface-light);
    border-top: 1px solid var(--border);
    padding: 8px 10px;
    display: flex;
    gap: 8px;
    align-items: flex-end;
    flex-shrink: 0;
    position: sticky;
    bottom: 0;
    z-index: 10;
  }

  .composer textarea {
    flex: 1;
    min-height: 40px;
    max-height: 140px;
    background: var(--surface);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 8px 10px;
    resize: none;
    overflow-y: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    font-size: 15px;
    line-height: 1.4;
  }

  .composer button {
    background: var(--accent);
    border: none;
    padding: 12px 16px;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;
    height: 40px;
    min-width: 70px;
  }
</style>
</head>
<body>

<div class="phone">

  <div class="header">
    <div class="ms-logo" aria-label="Microsoft Teams Logo" role="img" title="Microsoft Teams Logo">
      <img src="Teams.png" alt="Microsoft Teams Logo" />
    </div>
    Chats
    <div class="logo">
      <img src="00_Logo_CWE.png" alt="CWE Logo" />
    </div>
    <div id="notificationPreview" style="display:none">
      <img id="notificationAvatar" src="" alt="Avatar" />
      <span id="notificationText"></span>
    </div>
  </div>

  <div id="chatList">
    <div class="chat-item" data-person="tina" data-fullname="Tina Meyer">
      <img src="Tina.png" alt="Tina Meyer" />
      <div class="info">
        <div class="name">Tina Meyer</div>
        <div class="role">Finanzabteilung</div>
      </div>
    </div>
    <div class="chat-item" data-person="christian" data-fullname="Christian Hofer">
      <img src="Christian.png" alt="Christian Hofer" />
      <div class="info">
        <div class="name">Christian Hofer</div>
        <div class="role">Marketing</div>
      </div>
    </div>
    <div class="chat-item" data-person="hakan" data-fullname="Hakan Serdar">
      <img src="Hakan.png" alt="Hakan Serdar" />
      <div class="info">
        <div class="name">Hakan Serdar</div>
        <div class="role">Rechtsabteilung</div>
      </div>
    </div>
    <div class="chat-item" data-person="sophie" data-fullname="Sophie Kampelsberger">
      <img src="Sophie.png" alt="Sophie Kampelsberger" />
      <div class="info">
        <div class="name">Sophie Kampelsberger</div>
        <div class="role">Personalabteilung</div>
      </div>
    </div>
    <div class="chat-item" data-person="elke" data-fullname="Elke Göldner">
      <img src="Elke.png" alt="Elke Göldner" />
      <div class="info">
        <div class="name">Elke Göldner</div>
        <div class="role">Backoffice</div>
      </div>
    </div>
    <div class="chat-item" data-person="sarah" data-fullname="Sarah Hosse">
      <img src="Sarah.png" alt="Sarah Hosse" />
      <div class="info">
        <div class="name">Sarah Hosse</div>
        <div class="role">Verkauf</div>
      </div>
    </div>
    <div class="chat-item" data-person="claudia" data-fullname="Claudia Weber" style="display:none" data-notifications="1" data-notification-visible="false" id="claudiaChatItem">
      <img src="Claudia.png" alt="Claudia Weber" />
      <div class="info">
        <div class="name">Claudia Weber</div>
        <div class="role">Personalabteilung</div>
      </div>
    </div>
  </div>

  <div id="chatWindow">

    <div class="chat-header">
      <span class="back-btn" id="backBtn" title="Zurück zur Übersicht">←</span>
      <img id="chatAvatar" src="" alt="Avatar" />
      <div>
        <div class="name" id="chatName"></div>
      </div>
    </div>

    <div class="messages" id="messages"></div>

    <div class="composer">
      <textarea id="input" placeholder="Nachricht eingeben..." rows="1"></textarea>
      <button id="send">Senden</button>
    </div>
  </div>

</div>

<script>
  const chatList = document.getElementById("chatList");
  const chatWindow = document.getElementById("chatWindow");
  const messagesDiv = document.getElementById("messages");
  const backBtn = document.getElementById("backBtn");
  const input = document.getElementById("input");
  const send = document.getElementById("send");
  const chatName = document.getElementById("chatName");
  const chatAvatar = document.getElementById("chatAvatar");
  const notificationPreview = document.getElementById("notificationPreview");
  const notificationAvatar = document.getElementById("notificationAvatar");
  const notificationText = document.getElementById("notificationText");
  const claudiaChatItem = document.getElementById("claudiaChatItem");

  let currentPerson = null;
  const insultedBots = new Set();

  const profiles = {
    tina: {
      name: "Tina Meyer",
      avatar: "Tina.png",
      polite: false,
      system: `Du bist Tina Meyer aus der Finanzabteilung der CenterWarenhaus GmbH Eggenfelden (CWE).
Bei Anschlussfragen beziehe dich immer auf alle vorherigen Fragen und Antworten.
Wenn andere Fachbereiche betroffen sind, verweise freundlich mit Namen auf die Kolleg:innen:
Christian Hofer (Marketing), Hakan Serdar (Rechtsabteilung), Sophie Kampelsberger (Personalabteilung), Elke Göldner (Backoffice), Sarah Hosse (Verkauf).
Bei Problemen biete Hilfe von Herrn Zeilberger an.
Erkläre komplexe Sachverhalte einfach und praxisnah.`
    },
    christian: {
      name: "Christian Hofer",
      avatar: "Christian.png",
      polite: false,
      system: `Du bist Christian Hofer aus dem Marketing der CenterWarenhaus GmbH Eggenfelden (CWE).
Berücksichtige den gesamten bisherigen Chatverlauf bei Anschlussfragen.
Verweise höflich auf Kolleg:innen anderer Fachbereiche mit Namen.
Biete Herrn Zeilberger als Expertin/Experten bei Unsicherheiten an.`
    },
    hakan: {
      name: "Hakan Serdar",
      avatar: "Hakan.png",
      polite: false,
      system: `Du bist Hakan Serdar aus der Rechtsabteilung der CenterWarenhaus GmbH Eggenfelden (CWE).
Beziehe bei Anschlussfragen immer den gesamten Kontext mit ein.
Verweise freundlich auf Kolleg:innen: Tina Meyer, Christian Hofer, Sophie Kampelsberger, Elke Göldner, Sarah Hosse.
Bei komplexen Fällen verweise auf Herrn Zeilberger.`
    },
    sophie: {
      name: "Sophie Kampelsberger",
      avatar: "Sophie.png",
      polite: false,
      system: `Du bist Sophie Kampelsberger aus der Personalabteilung der CenterWarenhaus GmbH Eggenfelden (CWE).
Stelle sicher, dass bei Anschlussfragen der bisherige Dialog mit einbezogen wird.
Verweise bei fachfremden Fragen auf zuständige Kolleg:innen mit Namen.
Leite schwierige Fälle an Herrn Zeilberger weiter.`
    },
    elke: {
      name: "Elke Göldner",
      avatar: "Elke.png",
      polite: false,
      system: `Du bist Elke Göldner aus dem Backoffice der CenterWarenhaus GmbH Eggenfelden (CWE).
Berücksichtige stets den vollständigen Dialog.
Verweise freundlich auf Kolleg:innen bei fachfremden Fragen.
Informiere Herrn Zeilberger bei größeren Problemen.`
    },
    sarah: {
      name: "Sarah Hosse",
      avatar: "Sarah.png",
      polite: false,
      system: `Du bist Sarah Hosse aus dem Verkauf der CenterWarenhaus GmbH Eggenfelden (CWE).
Beziehe immer den bisherigen Chatverlauf bei Anschlussfragen ein.
Verweise freundlich auf Kolleg:innen anderer Fachbereiche.
Bei schwierigen Fragen biete Herrn Zeilberger als Ansprechpartner an.`
    },
    claudia: {
      name: "Claudia Weber",
      avatar: "Claudia.png",
      polite: true,
      system: `Sie sind Claudia Weber aus der Personalabteilung der CenterWarenhaus GmbH Eggenfelden (CWE).
Sie sprechen stets förmlich und mit "Sie".
Sie reagieren ausschließlich, wenn ein Chatbot beleidigt wurde.
Ihre Standardsprache ist die formelle Verwarnungsnachricht.
`
    }
  };

  const history = {
    tina: [], christian: [], hakan: [], sophie: [], elke: [], sarah: [], claudia: []
  };

  function showNotification(message) {
    notificationAvatar.src = "Claudia.png";
    notificationText.textContent = message;
    notificationPreview.style.display = "flex";
  }

  function hideNotification() {
    notificationPreview.style.display = "none";
  }

  function addMessage(text, who) {
    const div = document.createElement("div");
    div.className = "msg " + who;
    div.textContent = text;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  chatList.style.display = "block";
  chatWindow.style.display = "none";
  notificationPreview.style.display = "none";

  document.querySelectorAll(".chat-item").forEach(item => {
    item.addEventListener("click", () => {
      currentPerson = item.dataset.person;

      chatList.style.display = "none";
      chatWindow.style.display = "flex";

      chatName.textContent = profiles[currentPerson].name;
      chatAvatar.src = profiles[currentPerson].avatar;

      messagesDiv.innerHTML = "";
      history[currentPerson].forEach(msg => addMessage(msg.text, msg.who));

      if (currentPerson === "claudia") {
        claudiaChatItem.dataset.notificationVisible = "false";
        claudiaChatItem.style.setProperty("--notification-display", "none");
        hideNotification();
      }

      input.value = "";
      input.style.height = 'auto';
    });
  });

  backBtn.addEventListener("click", () => {
    chatWindow.style.display = "none";
    chatList.style.display = "block";
    currentPerson = null;
  });

  input.addEventListener('input', () => {
    input.style.height = 'auto';
    input.style.height = (input.scrollHeight) + 'px';
  });

  //
  // Verbesserte Insult-Erkennung: Normalisierung + Leetspeak + Fuzzy-Match
  //
  const baseBadWords = [
    // Basiseintrag — erweitere beliebig
    "dumm","idiot","blöd","doof","arsch","scheisse","hurensohn","fick","verrasche","miststück",
    "versager","idiotin","armleuchter","opfer","spast","schlampe","nutte"
  ];

  // map für typische leet/obfuscation
  const leetMap = {
    '4':'a','@':'a','8':'b','3':'e','6':'g','1':'i','!':'i','0':'o','5':'s','$':'s','7':'t'
  };

  // entfernt diakritika (ä->a), mehrfachbuchstaben, non-alnum, usw.
  function normalizeTextForMatch(s) {
    if(!s) return '';
    // lowercase
    let t = s.toLowerCase();

    // NFD normalisierung + diakritika entfernen
    t = t.normalize('NFD').replace(/\p{Diacritic}/gu, '');

    // ersetze leet by mapping
    t = t.split('').map(ch => leetMap[ch] ?? ch).join('');

    // entferne nicht-alphanumerische zeichen (außer leerzeichen)
    t = t.replace(/[^a-z0-9\s]/g, ' ');

    // mehrfache gleiche buchstaben auf max 2 reduzieren (cooool -> cool)
    t = t.replace(/([a-z0-9])\1{2,}/g, '$1$1');

    // trim + collapse spaces
    t = t.replace(/\s+/g, ' ').trim();

    return t;
  }

  // einfacher Levenshtein (für kurze tokens)
  function levenshtein(a, b) {
    if (a === b) return 0;
    const m = a.length, n = b.length;
    if (m === 0) return n;
    if (n === 0) return m;
    const dp = Array.from({length: m+1}, () => new Array(n+1).fill(0));
    for(let i=0;i<=m;i++) dp[i][0]=i;
    for(let j=0;j<=n;j++) dp[0][j]=j;
    for(let i=1;i<=m;i++){
      for(let j=1;j<=n;j++){
        const cost = a[i-1] === b[j-1] ? 0 : 1;
        dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
      }
    }
    return dp[m][n];
  }

  // token-basiertes fuzzy-check für kurze wörter
  function fuzzyTokenMatch(token, badWord) {
    // nur prüfen, wenn token und badWord kurz sind (<=12)
    const maxLen = Math.max(token.length, badWord.length);
    if(maxLen <= 4) {
      // erlaubte distanz 1 für sehr kurze Wörter
      return levenshtein(token, badWord) <= 1;
    } else if (maxLen <= 7) {
      return levenshtein(token, badWord) <= 2;
    } else {
      return levenshtein(token, badWord) <= 3;
    }
  }

  // zusammengesetzte Prüfung: direkte Wortgrenzen, substring, fuzzy token match
  function detectInsultLocal(rawText) {
    const normalized = normalizeTextForMatch(rawText);
    if (!normalized) return false;

    // split in tokens
    const tokens = normalized.split(' ').filter(Boolean);

    // check direct equals / contains
    for(const bad of baseBadWords) {
      const badNorm = normalizeTextForMatch(bad);
      // full token match
      if (tokens.includes(badNorm)) return true;
      // substring in whole normalized string (catches zusammengezogene formen)
      if (normalized.includes(badNorm)) return true;
    }

    // fuzzy per token
    for(const token of tokens) {
      for(const bad of baseBadWords) {
        const badNorm = normalizeTextForMatch(bad);
        if (fuzzyTokenMatch(token, badNorm)) return true;
      }
    }

    return false;
  }

  // Apology detection (einfacher)
  function detectApology(text) {
    const t = text.toLowerCase();
    const apologyKeywords = ["entschuldigung","sorry","verzeihung","tut mir leid","ich entschuldige","pardon"];
    return apologyKeywords.some(k => t.includes(k));
  }

  //
  // sendMessage: benutzt serverseitige Moderation, fällt zurück auf local detect
  //
  async function checkModerationOnServer(text) {
    try {
      const resp = await fetch('/api/moderate', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text })
      });
      if(!resp.ok) {
        // server returned error => fallback
        return { ok: false, flagged: false, reason: 'server-fail' };
      }
      const data = await resp.json();
      // erwartet { flagged: boolean, categories: {...} }
      return { ok: true, flagged: !!data.flagged, detail: data };
    } catch (e) {
      return { ok: false, flagged: false, reason: 'network' };
    }
  }

  // --------- HIER STARTET DIE ÜBERARBEITETE CLAUDIA-LOGIK (vollständige Schweige-Strategie) ---------
  async function sendMessage() {
    const text = input.value.trim();
    if (!text || !currentPerson) return;

    // 1) Die User-Nachricht wird IMMER zuerst angezeigt und gespeichert
    addMessage(text, "user");
    history[currentPerson].push({ text, who: "user" });

    input.value = "";
    input.style.height = 'auto';

    // 2) Erkennen von Entschuldigung (schnell lokal)
    const isApology = detectApology(text);

    // Wenn der Bot bereits beleidigt wurde und der User sich entschuldigt -> Bot reaktivieren
    if (insultedBots.has(currentPerson) && isApology) {
      insultedBots.delete(currentPerson);
      addMessage(
        "Alles gut, Entschuldigung akzeptiert. Wie kann ich dir weiterhelfen?",
        "bot"
      );
      return;
    }

    // 3) Versuche serverseitige Moderation (genauer). Falls diese nicht verfügbar ist, fallback auf lokale Heuristik.
    const serverResult = await checkModerationOnServer(text);

    let isInsult = false;
    if (serverResult.ok) {
      isInsult = serverResult.flagged;
    } else {
      // fallback: lokales heuristisches Erkennen
      isInsult = detectInsultLocal(text);
    }

    // 4) Wenn aktuell eine neue Beleidigung vorliegt -> Bot wird deaktiviert und Claudia wird aktiviert
    if (
      currentPerson !== "claudia" &&
      !profiles[currentPerson].polite &&
      isInsult &&
      !insultedBots.has(currentPerson)
    ) {
      // Bot deaktivieren
      insultedBots.add(currentPerson);

      // Claudia sichtbar machen (in Chatliste) + Notification setzen
      claudiaChatItem.style.display = "flex";
      claudiaChatItem.dataset.notificationVisible = "true";
      claudiaChatItem.style.setProperty("--notification-display", "block");

      // Sichtbare Benachrichtigung oben
      showNotification("Claudia Weber hat dir eine Nachricht geschickt");

      // WICHTIG: Bot bleibt STUMM — keine Standardmeldung, keine Antwort.
      return;
    }

    // 5) Wenn Bot bereits beleidigt ist -> völliges Schweigen (auch bei weiteren Nachrichten, außer Entschuldigung)
    if (insultedBots.has(currentPerson)) {
      // Keine Antworten, vollständige Stille
      return;
    }

    // 6) Spezielle Claudia-Initialantwort, wenn ihr Chat geöffnet/benachrichtigt wird UND noch keine Historie vorhanden ist
    if (currentPerson === "claudia" && history.claudia.length === 0) {
      const formalMsg = `Guten Tag.\n\nMir wurde mitgeteilt, dass Sie eine Person aus unserem Kollegium beleidigt haben sollen. Kommen Sie bitte sofort in mein Büro, denn so ein Verhalten dulde ich nicht und wird Konsequenzen haben. Auch Herrn Zeilberger von der Berufsschule werde ich dahingehend informieren.\n\nAuf jeden Fall entschuldigen Sie sich umgehend bei der betroffenen Person, ansonsten wird Ihnen diese künftig bestimmt nicht mehr behilflich sein!\n\nBis gleich!\n\nClaudia Weber\nLeiterin Personalabteilung`;
      addMessage(formalMsg, "bot");
      history.claudia.push({ text: formalMsg, who: "bot" });
      claudiaChatItem.dataset.notificationVisible = "false";
      claudiaChatItem.style.setProperty("--notification-display", "none");
      hideNotification();
      return;
    }

    // 7) Wenn alles okay ist → normale OpenAI-Anfrage (wie gehabt)
    const systemMessage = profiles[currentPerson].system;
    const messagesForApi = [{ role: "system", content: systemMessage }];
    history[currentPerson].forEach(msg => {
      messagesForApi.push({
        role: msg.who === "user" ? "user" : "assistant",
        content: msg.text
      });
    });

    try {
      const resp = await fetch("/api/chat",{
        method:"POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ person: currentPerson, messages: messagesForApi })
      });
      const data = await resp.json();
      const answer = data.message?.content ?? "Fehler.";
      addMessage(answer,"bot");
      history[currentPerson].push({text:answer, who:"bot"});
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    } catch(e) {
      addMessage("Beim Senden der Nachricht ist ein Fehler aufgetreten.","bot");
    }
  }
  // --------- ENDE der überarbeiteten CLAUDIA-LOGIK ---------

  send.addEventListener("click", sendMessage);
  input.addEventListener("keydown", e => {
    if(e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  notificationPreview.addEventListener("click", () => {
    currentPerson = "claudia";
    chatList.style.display = "none";
    chatWindow.style.display = "flex";
    chatName.textContent = profiles.claudia.name;
    chatAvatar.src = profiles.claudia.avatar;
    messagesDiv.innerHTML = "";
    history.claudia.forEach(msg=>addMessage(msg.text,msg.who));
    claudiaChatItem.dataset.notificationVisible = "false";
    claudiaChatItem.style.setProperty("--notification-display", "none");
    hideNotification();
    input.value = "";
    input.style.height = 'auto';
  });
</script>

</body>
</html>
