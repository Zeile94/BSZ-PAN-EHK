<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Herr Thamm — Buchführungsbot</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0}
    .chat{width:100%;max-width:900px;height:700px;display:flex;flex-direction:column;border:1px solid #ddd;border-radius:8px;overflow:hidden}
    .header{padding:12px;border-bottom:1px solid #eee;background:#fff}
    .messages{flex:1;overflow:auto;padding:12px;background:#fafafa}
    .row{margin-bottom:10px;display:flex}
    .msg{padding:10px 12px;border-radius:8px;display:inline-block;max-width:90%}
    .user{background:#d8f0ff;margin-left:auto}
    .assistant{background:#fff;border:1px solid #eee}
    .input{display:flex;padding:10px;gap:8px;border-top:1px solid #eee;background:#fff}
    textarea{flex:1;resize:none;padding:8px;border-radius:6px;border:1px solid #ccc}
    button{padding:8px 12px;border-radius:6px;border:none;background:#0b6efd;color:#fff;cursor:pointer}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .meta{font-size:12px;color:#666;margin-top:6px}
  </style>
</head>
<body>
  <div class="chat" role="region" aria-label="Chat mit Herr Thamm">
    <div class="header">
      <strong>Herr Thamm</strong> — Abteilungsleiter Finanzen, CenterWarenhaus GmbH
      <div class="meta">Lernfeld 8: Buchführung — stelle Fragen zu Buchungssätzen, Bilanz, GuV usw.</div>
    </div>

    <div id="messages" class="messages" aria-live="polite"></div>

    <div class="input">
      <textarea id="input" rows="2" placeholder="Frage eingeben... (z. B. Wie lautet der Buchungssatz für Warenkauf?)"></textarea>
      <button id="send">Senden</button>
    </div>
  </div>

  <script>
    const apiBase = ""; // leer = selbes Ursprung (wenn Frontend und Server zusammen deployed sind)
    const messagesDiv = document.getElementById("messages");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    function appendMessage(text, who) {
      const row = document.createElement("div");
      row.className = "row";
      const bubble = document.createElement("div");
      bubble.className = "msg " + (who === "user" ? "user" : "assistant");
      bubble.textContent = text;
      row.style.justifyContent = who === "user" ? "flex-end" : "flex-start";
      row.appendChild(bubble);
      messagesDiv.appendChild(row);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function send() {
      const text = input.value.trim();
      if (!text) return;
      appendMessage(text, "user");
      input.value = "";
      sendBtn.disabled = true;

      try {
        const resp = await fetch(apiBase + "/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: [{ role: "user", content: text }] })
        });
        if (!resp.ok) {
          const err = await resp.text();
          appendMessage("Fehler: " + err, "assistant");
        } else {
          const data = await resp.json();
          const assistantText = data.message?.content ?? "Keine Antwort erhalten.";
          appendMessage(assistantText, "assistant");
        }
      } catch (e) {
        appendMessage("Serverfehler: " + e.message, "assistant");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    appendMessage("Hallo! Ich bin Herr Thamm. Frag mich etwas zur Buchführung oder zu betrieblichen Zusammenhängen.", "assistant");
  </script>
</body>
</html>
