<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CWE Chat – Mitarbeiterportal</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f3f2f1;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .teams-window {
      display: flex;
      width: 600px; /* verschlankt */
      height: 450px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    /* Seitenleiste */
    .sidebar {
      width: 160px; /* vorher breiter, jetzt verschlankt */
      background-color: #464775;
      color: white;
      display: flex;
      flex-direction: column;
      padding-top: 1rem;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .sidebar-header img {
      width: 22px;
      height: 22px;
    }

    .contact {
      padding: 10px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .contact:hover {
      background-color: #585a96;
    }

    .contact.active {
      background-color: #6264a7;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #a4a6d1;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-weight: 600;
      font-size: 15px;
    }

    /* Chatbereich */
    .chat {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: #faf9f8;
    }

    .chat-header {
      padding: 10px 16px;
      border-bottom: 1px solid #ddd;
      background-color: #f3f2f1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chat-header .avatar {
      background-color: #a4a6d1;
    }

    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 10px;
      line-height: 1.4;
    }

    .message.user {
      align-self: flex-end;
      background-color: #cfe4fd;
    }

    .message.bot {
      align-self: flex-start;
      background-color: #e1e1e1;
    }

    .input-area {
      display: flex;
      align-items: flex-end;
      padding: 10px;
      border-top: 1px solid #ccc;
      background-color: #fff;
    }

    .input-area textarea {
      flex: 1;
      resize: none;
      border: 1px solid #ccc;
      border-radius: 20px;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 14px;
      outline: none;
      max-height: 150px;
      overflow-y: auto;
    }

    .input-area button {
      margin-left: 8px;
      background-color: #6264a7;
      color: white;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .input-area button:hover {
      background-color: #4b4d8a;
    }
  </style>
</head>
<body>
  <div class="teams-window">
    <div class="sidebar">
      <div class="sidebar-header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Microsoft_Office_Teams_%282018–present%29.svg" alt="Teams" />
        <span>Teams</span>
      </div>
      <div class="contact active" data-role="Tina">
        <div class="avatar">T</div>
        <span>Tina (Finanzen)</span>
      </div>
      <div class="contact" data-role="Christian">
        <div class="avatar">C</div>
        <span>Christian (Marketing)</span>
      </div>
    </div>

    <div class="chat">
      <div class="chat-header">
        <div class="avatar" id="chat-avatar">T</div>
        <div id="chat-name">Tina (Finanzen)</div>
      </div>

      <div class="chat-messages" id="chat-messages"></div>

      <div class="input-area">
        <textarea id="message-input" rows="1" placeholder="Nachricht eingeben..."></textarea>
        <button id="send-btn">➤</button>
      </div>
    </div>
  </div>

  <script>
    const contacts = document.querySelectorAll(".contact");
    const chatName = document.getElementById("chat-name");
    const chatAvatar = document.getElementById("chat-avatar");
    const chatMessages = document.getElementById("chat-messages");
    const messageInput = document.getElementById("message-input");
    const sendBtn = document.getElementById("send-btn");

    let activeChat = "Tina";

    contacts.forEach(contact => {
      contact.addEventListener("click", () => {
        contacts.forEach(c => c.classList.remove("active"));
        contact.classList.add("active");
        activeChat = contact.dataset.role;
        chatName.textContent = `${activeChat} (${activeChat === "Tina" ? "Finanzen" : "Marketing"})`;
        chatAvatar.textContent = activeChat.charAt(0);
        chatMessages.innerHTML = ""; // Chat leeren
      });
    });

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keypress", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Dynamische Höhe des Eingabefelds
    messageInput.addEventListener("input", () => {
      messageInput.style.height = "auto";
      messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + "px";
    });

    async function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;
      appendMessage("user", text);
      messageInput.value = "";
      messageInput.style.height = "auto";

      const rolePrompt = activeChat === "Tina"
        ? "Du bist Tina, frisch ausgelernte Kollegin in der Abteilung Finanzen der CenterWarenhaus GmbH Eggenfelden (CWE)."
        : "Du bist Christian, Mitarbeiter in der Marketing-Abteilung der CenterWarenhaus GmbH Eggenfelden (CWE).";

      const response = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          messages: [
            { role: "system", content: rolePrompt },
            { role: "user", content: text }
          ]
        })
      });

      const data = await response.json();
      appendMessage("bot", data.message.content);
    }

    function appendMessage(sender, text) {
      const div = document.createElement("div");
      div.classList.add("message", sender);
      div.textContent = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  </script>
</body>
</html>
